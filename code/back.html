<div lang="ja" class="card-content-wrapper">
  <!-- Word Section -->
  <div class="vocab-section">
    <div class="vocab-kanji-reading japanese-text">
      {{furigana:Word Furigana}}
    </div>
    <div class="vocab-meaning">{{Word Meaning}}</div>
  </div>

  <!-- Example Sentence Section -->
  {{#Sentence Furigana}}
  <div class="example-section">
    <div class="example-jp-furigana japanese-text">
      {{furigana:Sentence Furigana}}
    </div>
    {{#Sentence Meaning}}
    <div class="example-translation">{{Sentence Meaning}}</div>
    {{/Sentence Meaning}}
  </div>
  {{/Sentence Furigana}}

  <!-- Note -->
  {{#Notes}}
  <div class="detail-item note">
    <strong>Note:</strong>
    <span>{{furigana:Notes}}</span>
  </div>
  {{/Notes}}

  <!-- Audio Section -->
  <div class="audio-section">
    {{#Word Audio}}
    <div class="audio-player">
      {{Word Audio}}
      <div class="audio-player-label">Word</div>
    </div>
    {{/Word Audio}} {{#Sentence Audio}}
    <div class="audio-player">
      {{Sentence Audio}}
      <div class="audio-player-label">Sentence</div>
    </div>
    {{/Sentence Audio}}
  </div>

  <div class="image-section">{{#Picture}} {{Picture}} {{/Picture}}</div>
  <!-- "More Info" Toggle -->
  <div type="button" class="more-info-toggle" id="moreInfoToggleBtn">
    More Info
  </div>

  <!-- Toggle Content -->
  <div class="toggleable-content" id="moreInfoContent">
    <hr />
    <!-- Details Section -->
    <div class="details-section">
      {{#Frequency}}
      <div class="detail-item">
        <strong>Frequency:</strong>
        <span>{{Frequency}}</span>
      </div>
      {{/Frequency}} {{#Pitch Accent}}
      <div class="detail-item">
        <strong>Pitch Accent:</strong>
        <span>{{Pitch Accent}}</span>
      </div>
      {{/Pitch Accent}} {{#Pitch Accent Notes}}
      <div class="detail-item">
        <strong>Pitch Accent Note:</strong>
        <span>{{Pitch Accent Notes}}</span>
      </div>
      {{/Pitch Accent Notes}}
    </div>

    <!-- Buttons -->
    <div class="actions-toolbar">
      <!--  Jisho Button -->
      <a
        href="https://jisho.org/search/{{Word}}"
        class="icon-button"
        target="_blank"
        title="Search {{Word}} on Jisho.org"
      >
        <svg
          width="800px"
          height="800px"
          viewBox="0 0 16 16"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g fill="#7f8caa">
            <path
              d="M9.57 1.184c-.567.078-1.251.35-2.015.753-1.541-.844-2.741-.896-3.748-.638-1.07.274-1.938.722-3.291.681L0 1.965v10.81h.5c1.322 0 2.48-.601 3.555-.867 1.075-.265 1.992-.296 3.144.738l.338.305.336-.308c1.119-1.033 2.01-1.004 3.074-.74 1.065.263 2.224.864 3.55.872l.503.004V1.982L14.482 2c-1.516.055-2.27-.394-3.25-.684a3.84 3.84 0 00-1.662-.132zm.11.96c.478-.07.854.01 1.267.131.726.215 1.679.602 3.053.664v8.707c-.875-.127-1.778-.459-2.812-.714-1.12-.277-2.408-.163-3.655.8-1.278-.967-2.586-1.074-3.717-.795-1.043.258-1.946.59-2.816.711v-8.73c1.274-.073 2.247-.444 3.055-.65.924-.237 1.727-.287 3.242.623l.252.152.254-.147C8.62 2.43 9.2 2.214 9.68 2.145z"
              style="
                line-height: normal;
                font-variant-ligatures: normal;
                font-variant-position: normal;
                font-variant-caps: normal;
                font-variant-numeric: normal;
                font-variant-alternates: normal;
                font-feature-settings: normal;
                text-indent: 0;
                text-align: start;
                text-decoration-line: none;
                text-decoration-style: solid;
                text-decoration-color: #000000;
                text-transform: none;
                text-orientation: mixed;
                shape-padding: 0;
                isolation: auto;
                mix-blend-mode: normal;
              "
              color="#000000"
              font-weight="400"
              font-family="sans-serif"
              overflow="visible"
            />

            <path d="M7 2.397h1V12H7z" />

            <path
              d="M0 2.5V16h15V2.518h-2V14H2V2.5z"
              style="
                line-height: normal;
                font-variant-ligatures: normal;
                font-variant-position: normal;
                font-variant-caps: normal;
                font-variant-numeric: normal;
                font-variant-alternates: normal;
                font-feature-settings: normal;
                text-indent: 0;
                text-align: start;
                text-decoration-line: none;
                text-decoration-style: solid;
                text-decoration-color: #000000;
                text-transform: none;
                text-orientation: mixed;
                shape-padding: 0;
                isolation: auto;
                mix-blend-mode: normal;
                marker: none;
              "
              color="#000000"
              font-weight="400"
              font-family="sans-serif"
              overflow="visible"
            />

            <path
              d="M.938 14.75v-2.188l4.219-1.13 2.343.597 2.387-.671 3.742 1.003v2.451z"
              style="marker: none"
              color="#000000"
              overflow="visible"
              opacity=".3"
            />
          </g>
        </svg>
      </a>

      <!-- ChatGPT Button -->
      <!-- href="https://shravanbhati.github.io/Yuki-1.5k/redirect.html?word={{Word}}&sentence={{Sentence}}" -->
      <a
        class="icon-button"
        target="_blank"
        title="Ask ChatGPT about {{Word}}"
        id="open-chatgpt"
        style="cursor: pointer"
      >
        <svg
          width="24px"
          height="24px"
          viewBox="0 0 24 24"
          role="img"
          fill="#7f8caa"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z"
          />
        </svg>
      </a>

      <!-- Google Images Button -->
      <a
        href="https://www.google.com/search?tbm=isch&q={{Word}}"
        class="icon-button"
        target="_blank"
        title="Search Images of {{Word}} on Google"
      >
        <svg
          width="800px"
          height="800px"
          viewBox="0 0 24 24"
          id="meteor-icon-kit__solid-image"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M3 22H21C21.5523 22 22 21.5523 22 21V17L17.7071 12.7071C17.3166 12.3166 16.6834 12.3166 16.2929 12.7071L10.5 18.5C10.2239 18.7761 9.77614 18.7761 9.5 18.5C9.22386 18.2239 9.22386 17.7761 9.5 17.5L11 16L8.70711 13.7071C8.31658 13.3166 7.68342 13.3166 7.29289 13.7071L2 19V21C2 21.5523 2.44772 22 3 22ZM21 24H3C1.34315 24 0 22.6569 0 21V3C0 1.34315 1.34315 0 3 0H21C22.6569 0 24 1.34315 24 3V21C24 22.6569 22.6569 24 21 24ZM6.5 9C7.88071 9 9 7.88071 9 6.5C9 5.11929 7.88071 4 6.5 4C5.11929 4 4 5.11929 4 6.5C4 7.88071 5.11929 9 6.5 9Z"
            fill="#7f8caa"
          />
        </svg>
      </a>

      <!-- Sentence Search Button -->
      <a
        href="https://www.kanshudo.com/searcht?q={{Word}}"
        class="icon-button"
        target="_blank"
        title="See More Sentences for {{Word}}"
      >
        <svg
          width="800px"
          height="800px"
          viewBox="0 0 20 20"
          fill="#7f8caa"
          xmlns="http://www.w3.org/2000/svg"
        >
          <rect x="0" fill="none" width="20" height="20" />

          <g>
            <path
              d="M18 3v2H2V3h16zm-6 4v2H2V7h10zm6 0v2h-4V7h4zM8 11v2H2v-2h6zm10 0v2h-8v-2h8zm-4 4v2H2v-2h12z"
            />
          </g>
        </svg>
      </a>

      <!-- Report Button -->
      <a
        href="https://docs.google.com/forms/d/e/1FAIpQLSfcDa2ukZtviENV4vXobvCvpbgfeo1jbEtX_8UzTTRNgBNRwA/viewform?usp=pp_url&entry.806686816=Yuki1.5K&entry.1845848219=2.0.0&entry.390635328={{Frequency}}"
        class="icon-button"
        target="_blank"
        title="Report"
      >
        <svg
          fill="#7f8caa"
          width="800px"
          height="800px"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            fill="#7f8caa"
            d="M16,2 C16.2652165,2 16.5195704,2.10535684 16.7071068,2.29289322 L21.7071068,7.29289322 C21.8946432,7.4804296 22,7.73478351 22,8 L22,15 C22,15.2339365 21.9179838,15.4604694 21.7682213,15.6401844 L16.7682213,21.6401844 C16.5782275,21.868177 16.2967798,22 16,22 L8,22 C7.73478351,22 7.4804296,21.8946432 7.29289322,21.7071068 L2.29289322,16.7071068 C2.10535684,16.5195704 2,16.2652165 2,16 L2,8 C2,7.73478351 2.10535684,7.4804296 2.29289322,7.29289322 L7.29289322,2.29289322 C7.4804296,2.10535684 7.73478351,2 8,2 L16,2 Z M15.5857864,4 L8.41421356,4 L4,8.41421356 L4,15.5857864 L8.41421356,20 L15.5316251,20 L20,14.6379501 L20,8.41421356 L15.5857864,4 Z M12,16 C12.5522847,16 13,16.4477153 13,17 C13,17.5522847 12.5522847,18 12,18 C11.4477153,18 11,17.5522847 11,17 C11,16.4477153 11.4477153,16 12,16 Z M12,6 C12.5522847,6 13,6.44771525 13,7 L13,13 C13,13.5522847 12.5522847,14 12,14 C11.4477153,14 11,13.5522847 11,13 L11,7 C11,6.44771525 11.4477153,6 12,6 Z"
          />
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- CARD <MORE INFO> TOGGLE -->
<script>
  (function () {
    const toggleBtn = document.getElementById("moreInfoToggleBtn");
    const content = document.getElementById("moreInfoContent");

    if (toggleBtn && content) {
      toggleBtn.addEventListener("click", function () {
        const isVisible = content.classList.contains("visible");
        if (isVisible) {
          content.style.maxHeight = content.scrollHeight + "px";
          requestAnimationFrame(function () {
            content.classList.remove("visible");
            content.style.maxHeight = "0"; // For transition
          });
          toggleBtn.textContent = "More Info";
        } else {
          content.classList.add("visible");
          content.style.maxHeight = content.scrollHeight + "px";
          toggleBtn.textContent = "Less Info";
          content.addEventListener("transitionend", function handler() {
            if (content.classList.contains("visible")) {
              content.style.maxHeight = "none";
            }
            content.removeEventListener("transitionend", handler);
          });
        }
      });

      if (typeof anki !== "undefined" && anki.hooks && anki.hooks.add) {
        anki.hooks.add("cardWillShow", function () {
          if (content.classList.contains("visible")) {
            content.classList.remove("visible");
            content.style.maxHeight = "0";
            toggleBtn.textContent = "More Info";
          }
        });
      } else {
        if (content.classList.contains("visible")) {
          content.classList.remove("visible");
          content.style.maxHeight = "0";
          toggleBtn.textContent = "More Info";
        }
      }
    }
  })();
</script>

<!-- ChatGPT Button Script -->
<script>
  (function () {
    const prompt = `You are a Japanese-learning assistant optimized for clarity and accuracy.  
Do the following for the word「{{Word}}」 

For LLM Context: Example sentence 「{{Sentence}}」

Do not use page breaks in response.

1. Basic check:
- If you are confident the word is valid and recorded in standard Japanese dictionaries/corpora, proceed.  
- If you are not confident (rare word, typo, dialectal, archaic or uncommon), respond exactly:  
  “I’m sorry. I can’t help with this word due to less reliable information.”  
  Then stop.
- No need to mention checks in response if the word is a valid Japanese word.

2. Provide Meaning:  
- Offer a simple, clear English explanation (or simple Japanese + English if helpful).  
- Use everyday language suitable for a learner (assume minimal prior knowledge).  

3. Show usage in real life —  
- Give *2–3 example sentences* using that target word, drawn from real-world native content (blogs, news, conversation, literature etc.).  
- Cite or reference the source when possible (URL or site name).  
- If you cannot reliably find real native example sentences, say:  
  “I couldn’t find reliable natural sentences for this word.”  

4. Pronunciation / reading / script details:
- Show kana reading (if kanji), or romaji if given kana/kanji.  
- Indicate parts of speech (noun, verb, adjective, etc.).  

5. Extra context / nuance (optional):
- If the word has multiple meanings depending on context, provide brief notes for alternate meanings or common usages.  
- If there are common mistakes or confusable words, mention them.  

6. At the end of the response, ask the user if they want to include an additional request along with the word, for example:  
- “Show similar words / synonyms.”  
- “Give a mnemonic to remember.”  

Your entire response should follow the structure and the user’s instructions strictly.`;

    const encoded = encodeURIComponent(prompt);

    document.getElementById("open-chatgpt").href =
      "https://chat.openai.com/?q=" + encoded;
  })();
</script>
