<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Open in ChatGPT - YukiNihongo</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; padding:16px}
  .box{max-width:900px;margin:0 auto}
  textarea{width:100%;height:220px;margin-top:12px;padding:8px;font-size:15px}
  button{display:inline-block;margin-top:8px;padding:10px 14px;font-size:16px;border-radius:8px;border:0;background:#0b74de;color:#fff}
  a.fallback{display:inline-block;margin-top:10px;color:#0b74de}
  .hint{color:#666;margin-top:10px}
</style>
</head>
<body>
<div class="box">
  <h2>Opening ChatGPT…</h2>
  <p class="hint">If nothing opens automatically, copy the prompt below and paste it into the ChatGPT app.</p>
  <div id="ui"></div>
</div>

<script>
(function(){
  // editable central template — edit here
  const promptTemplate = `You are a Japanese-learning assistant optimized for clarity and accuracy.
Do the following for the word「{{word}}」

Context sentence: 「{{sentence}}」

Do not use page breaks in response.

1. Basic check: If word not reliably documented, say "I’m sorry. I can’t help with this word due to less reliable information." Then stop.
2. Provide Meaning: Simple English (or simple Japanese + English)
3. Show usage: 2–3 native example sentences with sources (or say you couldn't find reliable ones)
4. Pronunciation / reading / script details: kana/romaji, part of speech
5. Extra nuance when relevant
End with: "Do you want anything else for this word? (synonyms, mnemonic, nuance?)"`;

  // read params (browser decodes percent encoding)
  const params = new URLSearchParams(location.search);
  const fields = { word: params.get('word') || '', sentence: params.get('sentence') || '' };

  // fill template
  const filled = promptTemplate.replace(/\{\{(\w+)\}\}/g, (_, k) => fields[k] || '');
  
  const webURL = 'https://chat.openai.com/?q=' + encodeURIComponent(filled);
  
  // Use replace so Back doesn't return to this page
  try {
    location.replace(webURL);
  } catch (e) {
    /* UI fallback below (will do later)*/
  }

  // UI fallback (copy + direct web link) in case the browser blocks navigation or app doesn't accept the query
  const ui = document.getElementById('ui');
  ui.innerHTML = `
    <p>If the ChatGPT app didn't open, use the button below to open the web chat or copy the prompt.</p>
    <a class="fallback" id="openWeb" href="${webURL}" target="_blank">Open ChatGPT (web)</a>
    <textarea id="promptArea"></textarea>
    <br><button id="copyBtn">Copy prompt</button>
  `;
  document.getElementById('promptArea').textContent = filled;
  document.getElementById('copyBtn').addEventListener('click', function(){
    const t = document.getElementById('promptArea');
    t.select();
    document.execCommand('copy');
    this.textContent = 'Copied ✓';
    setTimeout(()=> this.textContent = 'Copy prompt',1400);
  });
})();
</script>
</body>
</html>
